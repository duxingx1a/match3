# 星际争霸II 消除游戏自动化工具

一个基于 Python 的自动化工具，用于《星际争霸II》中的消除类小游戏。
✅ 已支持 1080P / 2K / 4K 全分辨率——无需固定坐标，无需模板缩放，一次配置即可随换显示器/缩放比例自动适配。

## 功能特性

- 🎯 **自动识别棋盘**: 单通道（G 通道）平均色 + 统一颜色字典，自动适配1080P、2K、4K分辨率(别的不支持)
- 🧠 **智能决策**: 模拟所有可能的移动,选择能产生最长连锁的最佳方案
- 🖱️ **自动操作**: 自动执行鼠标点击完成方块交换
- ⌨️ **热键控制**: 支持快捷键启动/暂停/退出
- 📊 **可视化调试**: 提供棋盘重建和最佳移动标注功能

## 项目结构

```
sc2-match3-bot/
├── main.py           # 主程序入口,处理自动点击和键盘监听
├── recognize.py      # 图像识别模块,截图和棋盘识别
├── eliminate.py      # 消除逻辑和最佳移动计算
├── requirements.txt  # 项目依赖
└── template/         # 模板图像文件夹（仅用于重建拼图，不再参与识别）
    ├── blue.png
    ├── bone.png
    ├── green.png
    ├── purple.png
    ├── red.png
    └── yellow.png
```

## 环境要求

- Windows 操作系统
- Python 3.9+
- 《星际争霸II》游戏窗口（需要设为最大化窗口，避免全屏黑屏）

## 安装步骤

1. **克隆或下载项目**

2. **安装依赖**
```bash
pip install -r requirements.txt
```

依赖包含:
- `numpy==2.3.4` - 数组计算
- `Pillow==12.0.0` - 图像操作
- `PyAutoGUI==0.9.54` - 鼠标控制
- `pynput==1.7.7` - 键盘监听
- `pywin32==305.1` - Windows API 调用

1. **准备模板图像**

在 `template/` 文件夹中放置 6 种方块的模板图像:
- `blue.png` - 蓝色方块
- `bone.png` - 骨头方块
- `green.png` - 绿色方块
- `purple.png` - 紫色方块
- `red.png` - 红色方块
- `yellow.png` - 黄色方块

## 使用方法

### 1. 启动程序

```bash
python main.py
```

### 2. 调整游戏窗口

- 确保《星际争霸II》游戏窗口标题包含 "《星际争霸II》"
- 无边框窗口化最佳，真全屏会抓黑图
- 工具自动按分辨率比例计算棋盘区域，无需手动改坐标

### 3. 使用热键控制

| 热键 | 功能 |
|------|------|
| `Space` | 开始自动点击 |
| `Z / X / C / V / B` | 暂停自动点击(用于释放技能) |
| `F2` | 退出程序 |
| `F3` | 单次运行 |
| `Ctrl+C` | 强制退出(终端) |

### 4. 调试模式

运行 [eliminate.py](eliminate.py) 可进行单次分析和可视化:

```bash
python eliminate.py
```

这将显示:
- 识别出的棋盘矩阵
- 最佳移动建议
- 预计消除数量和连锁轮数
- 带标记的棋盘图像

## 核心算法

### 棋盘识别 ([`recognize.convert_image_to_mat`](recognize.py))

1. 截取游戏窗口的棋盘区域
2. 每格 block = height // 8 像素动态计算
3. 提取G 通道平均值，与「跨分辨率统一颜色字典」比距离

### 最佳移动计算 ([`eliminate.find_best_move`](eliminate.py))

1. 遍历所有可能的相邻交换(112 种组合)
2. 对每个移动进行 3 次模拟(因随机掉落)
3. 评分公式: `评分 = 连锁轮数 × 10 + 总消除数`
4. 返回评分最高的移动

### 消除模拟 ([`eliminate.simulate_swap`](eliminate.py))

1. 交换两个方块
2. 检测并消除水平/垂直 3 连
3. 模拟方块下落和随机生成
4. 重复直到无可消除方块
5. 记录总消除数和连锁轮数


## 工具函数

### 图像裁剪 ([utils.py](utils.py))

用于生成模板图像:

```bash
python utils.py
```

## 性能优化建议

1. **减少模拟次数**: 降低 `simulations` 参数可提升速度,但可能影响准确性
2. **调整点击延迟**: 根据游戏响应速度调整 `time.sleep()` 值

## 注意事项

⚠️ **重要提示**:
- 本工具仅用于学习和研究目的
- 使用自动化工具可能违反游戏服务条款
- 请谨慎使用,风险自负

## 故障排除

### 问题: 无法找到窗口

- 确认游戏窗口标题包含 "《星际争霸II》"
- 检查窗口是否最小化或被遮挡


